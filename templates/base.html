<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Phoenix Fire Main Database</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <style>
    .page-wrap { animation: pageEnter 160ms ease-out; }
    @keyframes pageEnter {
      from { opacity: 0; transform: translateX(8px); }
      to   { opacity: 1; transform: translateX(0); }
    }

    body.page-exit .page-wrap {
      opacity: 0;
      transform: translateX(-14px);
      transition: opacity 140ms ease, transform 140ms ease;
    }

    @media (prefers-reduced-motion: reduce) {
      .page-wrap { animation: none; }
      body.page-exit .page-wrap { transition: none; }
    }

    /* =========================
       GLOBAL BACK BUTTON STYLE
       ========================= */
    .btn-back,
    a.btn-back,
    button.btn-back {
      background-color: var(--bs-success) !important;
      border-color: var(--bs-success) !important;
      color: #fff !important;
    }

    .btn-back:hover,
    a.btn-back:hover,
    button.btn-back:hover {
      filter: brightness(0.95);
      color: #fff !important;
    }

    /* Footer spacing */
    .app-footer { padding-bottom: 24px; }

    /* Hide print-only blocks on screen */
    .print-only { display: none; }

    /* Print behaviour */
    @media print {
      nav.navbar,
      .no-print {
        display: none !important;
      }

      body {
        background: #fff !important;
      }

      main.container {
        margin: 0 !important;
        padding: 0 !important;
      }

      .print-letterhead {
        display: flex !important;
      }

      .page-wrap {
        animation: none !important;
      }

      .print-only { display: block !important; }
    }
  </style>
</head>

<body class="bg-light">

<!-- NAV BAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">

    <!-- BRAND WITH LOGO -->
    <a class="navbar-brand fw-semibold d-flex align-items-center gap-2"
       href="{% url 'dashboard' %}">
      {% if client_profile and client_profile.company_logo %}
        <img src="{{ client_profile.company_logo.url }}"
             alt="Company Logo"
             style="height:32px;width:auto;"
             class="rounded bg-white p-1">
      {% endif %}
      <span>Phoenix Fire Main Database</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav me-auto">

        <li class="nav-item">
          <a class="nav-link" href="{% url 'dashboard' %}">Dashboard</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="{% url 'customers:list' %}">Customers</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="{% url 'properties:list' %}">Properties</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="{% url 'quotations:list' %}">Quotations</a>
        </li>

        <!-- SETTINGS -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="settingsDropdown"
             role="button" data-bs-toggle="dropdown">
            Settings
          </a>

          <ul class="dropdown-menu">
            <li class="dropdown-header text-uppercase small text-muted">Codes</li>

            <li>
              <a class="dropdown-item" href="{% url 'codes:efsm_list' %}">
                <i class="bi bi-shield-check me-2"></i> EFSM Codes
              </a>
            </li>

            <li>
              <a class="dropdown-item" href="{% url 'codes:defect_list' %}">
                <i class="bi bi-exclamation-triangle me-2"></i> Defect Codes
              </a>
            </li>

            <li>
              <a class="dropdown-item" href="{% url 'codes:asset_list' %}">
                <i class="bi bi-box-seam me-2"></i> Asset Codes
              </a>
            </li>

            <li>
              <a class="dropdown-item" href="{% url 'codes:dropdown_list_list' %}">
                <i class="bi bi-list-check me-2"></i> Dropdown Lists
              </a>
            </li>

            <li><hr class="dropdown-divider"></li>

            <li class="dropdown-header text-uppercase small text-muted">
              Main Database
            </li>

            <li>
              <a class="dropdown-item" href="{% url 'company:client_profile' %}">
                <i class="bi bi-building me-2"></i> Client
              </a>
            </li>

            <li>
              <a class="dropdown-item" href="{% url 'email_templates:list' %}">
                <i class="bi bi-envelope-paper me-2"></i> Email Templates
              </a>
            </li>
          </ul>
        </li>
      </ul>

      <!-- AUTH -->
      <ul class="navbar-nav">
        {% if user.is_authenticated %}
          <li class="nav-item">
            <span class="navbar-text me-3">
              Logged in as {{ user.username }}
            </span>
          </li>
          <li class="nav-item">
            <a class="btn btn-outline-light btn-sm" href="/admin/logout/">Logout</a>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="btn btn-outline-light btn-sm" href="/admin/login/">Login</a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<!-- PAGE CONTENT -->
<main class="container my-4 page-wrap">

  <!-- PRINT LETTERHEAD -->
  {% if client_profile and client_profile.company_logo %}
    <div class="print-letterhead d-none d-print-flex mb-4">
      <img src="{{ client_profile.company_logo.url }}"
           alt="Company Logo"
           style="height:70px;width:auto;">
    </div>
  {% endif %}

  <!-- âœ… GLOBAL GREEN BACK BUTTON -->
  <div class="mb-3 no-print">
    <button type="button"
            class="btn btn-back btn-sm"
            onclick="goBackAnimated()"
            title="Back">
      <i class="bi bi-arrow-left"></i>
    </button>
  </div>

  <!-- MESSAGES -->
  {% if messages %}
    <div class="mb-3 no-print">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% block content %}{% endblock %}

  <!-- PRINT-ONLY FOOTER -->
  <footer class="container my-4 text-muted small app-footer print-only">
    {% if client_profile %}
      <div class="d-flex flex-wrap gap-3 align-items-start justify-content-between border-top pt-3">
        <div class="fw-semibold">
          {{ client_profile.trading_name }}
        </div>

        <div style="max-width:420px;">
          {{ client_profile.company_address|linebreaksbr }}
        </div>

        <div class="text-end">
          <div>{{ client_profile.company_phone }}</div>
          <div>{{ client_profile.company_email }}</div>
          <div>ABN: {{ client_profile.company_abn }}</div>
        </div>
      </div>
    {% endif %}
  </footer>

</main>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function goBackAnimated() {
    const reduceMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (reduceMotion) {
      window.history.back();
      return;
    }
    document.body.classList.add("page-exit");
    setTimeout(() => window.history.back(), 150);
  }
</script>

</body>
</html>
