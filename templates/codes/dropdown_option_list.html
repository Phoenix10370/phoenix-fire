{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h3 mb-1">Options</h1>
    <div class="text-muted small">
      List: <span class="fw-semibold">{{ dropdown_list.name }}</span>
      {% if dropdown_list.slug %} · <code>{{ dropdown_list.slug }}</code>{% endif %}
    </div>
  </div>

  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{% url 'codes:dropdown_list_list' %}">
      Back to Lists
    </a>
    <a class="btn btn-primary"
       href="{% url 'codes:dropdown_option_create' dropdown_list.pk %}">
      Add Option
    </a>
  </div>
</div>

<!-- ✅ Search / filter -->
<div class="mb-3">
  <input id="optionSearch" class="form-control" placeholder="Search label or parent..." />
</div>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Label</th>
          <th style="width: 240px;">Parent</th>
          <th class="text-end" style="width: 120px;">Sort</th>
          <th style="width: 120px;">Status</th>
          <th class="text-end" style="width: 240px;">Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for item in items %}
          <tr>
            <td class="fw-semibold">{{ item.label }}</td>
            <td>
              {% if item.parent %}
                {{ item.parent.label }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td class="text-end">{{ item.sort_order }}</td>
            <td>
              {% if item.is_active %}
                <span class="badge bg-success">Active</span>
              {% else %}
                <span class="badge bg-secondary">Inactive</span>
              {% endif %}
            </td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-secondary"
                 href="{% url 'codes:dropdown_option_update' item.pk %}">
                Edit
              </a>
              <a class="btn btn-sm btn-outline-danger"
                 href="{% url 'codes:dropdown_option_delete' item.pk %}">
                Delete
              </a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="5" class="text-muted">No options yet.</td>
          </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>
</div>

<script>
  (function () {
    const searchInput = document.getElementById("optionSearch");
    const tableBody = document.querySelector("table tbody");
    if (!searchInput || !tableBody) return;

    searchInput.addEventListener("input", () => {
      const q = (searchInput.value || "").trim().toLowerCase();
      const rows = Array.from(tableBody.querySelectorAll("tr"));
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(q) ? "" : "none";
      });
    });
  })();
</script>
{% endblock %}
